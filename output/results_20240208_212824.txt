CHAPTER 1: INTRODUCTION
# This section introduces the purpose and background of the analysis.

In this analysis, we aim to evaluate the performance of different reject options for Information Treatment Effect (ITE) models.The ITE model predicts the individual treatment effects in a given dataset, providing valuable insights into the impact of interventions.
For your information, this file has been automatically generated on: 2024-02-08 21:28
\Chapter 2: Preprocessing

# This section executes the data retrieval, preprocessing and splitting in a training and dataset.During the whole file, the used dataset is: TWINS

CHAPTER 3: Training of the ITE Model

# This section provides details about the model selection, training process, and any hyperparameter tuning.
The trained ITE model is a T-LEARNER.
The two individually trained models are: LogisticRegression

CHAPTER 4: Evaluate treated and control groups seperately

# This section evaluates the individually trained models (two as we used a T-learner).
The used performance measures are:

 - Confusion Matrix
 - Accuracy: overall correctness of the model ((TP + TN) / (TP + TN + FP + FN))
 - Precision: It measures the accuracy of positive predictions (TP / (TP + FP))
 - Recall: ability of the model to capture all the relevant cases (TP / (TP + FN))
 - F1 Score: It balances precision and recall, providing a single metric for model evaluation (2 * (Precision * Recall) / (Precision + Recall))
 - ROC

Evaluation of the individual models based on the **training data**
Confusion Matrix:
+-----------------+---------------+---------------+
|     Metric      | Treated Group | Control Group |
+-----------------+---------------+---------------+
| True Positives  |     3732      |     3645      |
| False Positives |      126      |      112      |
| False Negatives |      361      |      387      |
| True Negatives  |      380      |      377      |
+-----------------+---------------+---------------+

Metrics:
+-----------+---------------+---------------+
|  Metric   | Treated Group | Control Group |
+-----------+---------------+---------------+
| Accuracy  |     0.89      |     0.89      |
| Precision |     0.75      |     0.77      |
|  Recall   |     0.51      |     0.49      |
|    F1     |     0.61      |      0.6      |
|    AUC    |     0.74      |     0.73      |
+-----------+---------------+---------------+


Evaluation of the individual models based on the **test data**
Confusion Matrix:
+-----------------+---------------+---------------+
|     Metric      | Treated Group | Control Group |
+-----------------+---------------+---------------+
| True Positives  |      917      |      902      |
| False Positives |      40       |      19       |
| False Negatives |      105      |      120      |
| True Negatives  |      79       |      98       |
+-----------------+---------------+---------------+

Metrics:
+-----------+---------------+---------------+
|  Metric   | Treated Group | Control Group |
+-----------+---------------+---------------+
| Accuracy  |     0.87      |     0.88      |
| Precision |     0.66      |     0.84      |
|  Recall   |     0.43      |     0.45      |
|    F1     |     0.52      |     0.59      |
|    AUC    |     0.69      |     0.71      |
+-----------+---------------+---------------+

Chapter 4: Evaluate overall ITE Model: Performance 

# This section evaluates the overal performance of the ITE model.
The used performance measures are: 

 - Root Mean Squared Error (RMSE) of the ITE 
 - Accurate estimate of the ATE 
 - Accurancy of ITE


CHAPTER 7: EVALUATE OVERALL ITE MODEL: COST 

# This section evaluates the overal misclassification costs of the ITE model.

CHAPTER 7: REJECTION 

# This section executes and reports metrics for ITE models with rejection.
# Every indicated change are in comparision to the base ITE model without rejection.

ARCHITECTURE TYPE 0: NO REJECTION -- BASELINE MODEL

ARCHITECTURE TYPE 1: SEPARATED

REJECTION TYPE 1A: OUT OF DISRIBUTION

Running Experiment 1 - Separated Rejector - NearestNeighbors with optimizing Micro Distance (3D ROC)
Running Experiment 2 - Separated Rejector - OneClassSVM with optimizing Micro Distance (3D ROC)
Running Experiment 3 - Separated Rejector - OneClassSVM with optimizing Combined Quality
REJECTION TYPE 1C: SCORE MODEL

 - Not done yet

ARCHITECTURE TYPE 2: DEPENDENT

REJECTION TYPE 2A: REJECTION BASED ON PROBABILITIES BY MINIMIZING 3DROC 

VARIANT TYPE 2A I: OPTIMIZATION OF SINGLE BOUNDARIES BY MINIMIZING 3DROC 

ITE values witht a probability between the optimal underbound 0.42584862727147343 and the optimal upperbound 0.5741513727285266 are rejected 
VARIANT TYPE 2A II: OPTIMIZATION OF DOUBLE BOUNDARIES BY MINIMIZING 3DROC  

ITE values witht a probability between the optimal underbound 0.45 and the optimal upperbound 0.55 are rejected 
REJECTION TYPE 2A: REJECTION BASED ON PROBABILITIES BY MINIMIZING MISCLASSIFICATION COSTS 

ITE values witht a probability between the optimal underbound 0.39821843333277407 and the optimal upperbound 0.6017815666672259 are rejected 

Table of test_set (First 20 rows)
+-----------+-----------+-----------+-----------+-----------+----------+----------+------+------+------+--------------+---------------+--------------+------------+-------------+--------------+----------+-----------------+-------+------------------+------------------+---------------+----------+
| treatment | y_t1_pred | y_t1_prob | y_t0_pred | y_t0_prob | ite_pred | ite_prob | y_t0 | y_t1 | ite  |   category   | category_pred | category_rej | ite_reject | ite_correct | ite_rejected | cost_ite | cost_ite_reject |  ood  | y_t1_reject_prob | y_t0_reject_prob | y_reject_prob | y_reject |
+-----------+-----------+-----------+-----------+-----------+----------+----------+------+------+------+--------------+---------------+--------------+------------+-------------+--------------+----------+-----------------+-------+------------------+------------------+---------------+----------+
|     0     |    0.0    |  0.0211   |    0.0    |  0.0492   |   0.0    | -0.0281  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | True  |      False       |      False       |     False     |  False   |
|     1     |    0.0    |   0.078   |    0.0    |  0.0698   |   0.0    |  0.0081  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.4133   |    0.0    |  0.3538   |   0.0    |  0.0595  | 1.0  | 1.0  | 0.0  |  Sure Thing  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | True  |       True       |      False       |     False     |  False   |
|     0     |    0.0    |  0.4873   |    0.0    |  0.4673   |   0.0    |  0.0199  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |     R      |    True     |     True     |    0     |        2        | True  |       True       |       True       |     True      |   True   |
|     0     |    0.0    |  0.2544   |    0.0    |  0.2975   |   0.0    | -0.0431  | 1.0  | 1.0  | 0.0  |  Sure Thing  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.0136   |    0.0    |  0.0291   |   0.0    | -0.0155  | 1.0  | 0.0  | -1.0 | Sleeping Dog |  Lost Cause   |  Lost Cause  |    0.0     |    False    |    False     |    10    |       10        | True  |      False       |      False       |     False     |  False   |
|     0     |    1.0    |  0.7926   |    1.0    |  0.7762   |   0.0    |  0.0163  | 1.0  | 1.0  | 0.0  |  Sure Thing  |  Sure Thing   |  Sure Thing  |    0.0     |    True     |    False     |    0     |        0        | True  |      False       |      False       |     False     |  False   |
|     1     |    0.0    |  0.4709   |    1.0    |  0.5149   |   -1.0   |  -0.044  | 0.0  | 0.0  | 0.0  |  Lost Cause  | Sleeping Dog  | Sleeping Dog |     R      |    False    |     True     |    0     |        2        | False |       True       |       True       |     True      |   True   |
|     0     |    0.0    |  0.0004   |    0.0    |  0.0006   |   0.0    | -0.0001  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | True  |      False       |      False       |     False     |  False   |
|     1     |    0.0    |   0.005   |    0.0    |  0.0171   |   0.0    | -0.0121  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | True  |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.0154   |    0.0    |  0.0198   |   0.0    | -0.0044  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.2179   |    0.0    |   0.27    |   0.0    | -0.0521  | 1.0  | 0.0  | -1.0 | Sleeping Dog |  Lost Cause   |  Lost Cause  |    0.0     |    False    |    False     |    10    |       10        | True  |      False       |      False       |     False     |  False   |
|     1     |    0.0    |  0.0493   |    0.0    |   0.085   |   0.0    | -0.0357  | 1.0  | 0.0  | -1.0 | Sleeping Dog |  Lost Cause   |  Lost Cause  |    0.0     |    False    |    False     |    10    |       10        | True  |      False       |      False       |     False     |  False   |
|     1     |    0.0    |  0.0305   |    0.0    |  0.0585   |   0.0    |  -0.028  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | True  |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.1646   |    0.0    |  0.2318   |   0.0    | -0.0672  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     1     |    0.0    |  0.0314   |    0.0    |  0.0197   |   0.0    |  0.0117  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.0492   |    0.0    |  0.0511   |   0.0    | -0.0019  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.0118   |    0.0    |  0.0174   |   0.0    | -0.0056  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     0     |    0.0    |  0.1142   |    0.0    |  0.1219   |   0.0    | -0.0077  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
|     1     |    0.0    |  0.0194   |    0.0    |  0.0321   |   0.0    | -0.0127  | 0.0  | 0.0  | 0.0  |  Lost Cause  |  Lost Cause   |  Lost Cause  |    0.0     |    True     |    False     |    0     |        0        | False |      False       |      False       |     False     |  False   |
+-----------+-----------+-----------+-----------+-----------+----------+----------+------+------+------+--------------+---------------+--------------+------------+-------------+--------------+----------+-----------------+-------+------------------+------------------+---------------+----------+
# Experiment 1: Experiment 1: Separated Rejector - NearestNeighbors with optimizing Micro Distance (3D ROC)
# Experiment 2: Experiment 2: Separated Rejector - OneClassSVM with optimizing Micro Distance (3D ROC)
# Experiment 3: Experiment 3: Separated Rejector - OneClassSVM with optimizing Combined Quality

Table of results of the experiments
╭─────────────────────────┬───────────┬───────────┬───────────┬───────────┬───────────┬───────────┬───────────┬───────────╮
│                         │         0 │         1 │         2 │         3 │         4 │         5 │         6 │         7 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Rejection Rate          │    0      │    0.1531 │    0      │    0.4956 │    0.5732 │    0.0307 │    0.0162 │    0.0456 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Accuracy                │    0.9268 │    0.927  │    0.9268 │    0.9348 │    0.9394 │    0.9348 │    0.93   │    0.937  │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ RMSE                    │    0.3315 │    0.3296 │    0.3315 │    0.3155 │    0.3114 │    0.3262 │    0.3301 │    0.3197 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ ATE Accuracy            │   -1.1455 │   -1.2364 │   -1.1455 │   -0.871  │   -0.9048 │   -1.1346 │   -1.1404 │   -1.0612 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Micro TPR               │    0.0331 │    0.0305 │    0.0331 │    0.0685 │    0.069  │    0.0282 │    0.0268 │    0.0224 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Micro FPR               │    0.0099 │    0.0078 │    0.0099 │    0.0065 │    0.0055 │    0.0029 │    0.0057 │    0.0029 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Micro F1 Score          │    0.0565 │    0.0537 │    0.0565 │    0.1176 │    0.1194 │    0.0526 │    0.0485 │    0.042  │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Micro Distance (3D ROC) │    0.9669 │    0.9815 │    0.9669 │    1.0552 │    1.0934 │    0.9723 │    0.9733 │    0.9787 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Macro TPR               │    0.011  │    0.0102 │    0.011  │    0.0228 │    0.023  │    0.0094 │    0.0089 │    0.0075 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Macro FPR               │    0.0033 │    0.0026 │    0.0033 │    0.0022 │    0.0018 │    0.001  │    0.0019 │    0.001  │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Macro F1 Score          │    0.0188 │    0.0179 │    0.0188 │    0.0392 │    0.0398 │    0.0175 │    0.0162 │    0.014  │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Macro Distance (3D ROC) │    0.989  │    1.0016 │    0.989  │    1.0957 │    1.1328 │    0.9911 │    0.9912 │    0.9936 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Accuracy with Rejection │    0.8754 │    0.8778 │    0.8754 │    0.893  │    0.8962 │    0.89   │    0.8832 │    0.8943 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Coverage with Rejection │    1      │    0.8469 │    1      │    0.5044 │    0.4268 │    0.9693 │    0.9838 │    0.9544 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Prediction Quality      │    0.8754 │    0.8778 │    0.8754 │    0.893  │    0.8962 │    0.89   │    0.8832 │    0.8943 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Rejection Quality       │    0      │    1.1208 │    0      │    1.1677 │    1.1443 │    9.9364 │   10.308  │    7.5904 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Combined Quality        │    0.8754 │    0.7645 │    0.8754 │    0.5211 │    0.4627 │    0.8807 │    0.8785 │    0.8772 │
├─────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Misclassification Cost  │ 2395      │ 2698      │ 2395      │ 3320      │ 3499      │ 2355      │ 2384      │ 2313      │
╰─────────────────────────┴───────────┴───────────┴───────────┴───────────┴───────────┴───────────┴───────────┴───────────╯
# Experiment 1: Experiment 1: Separated Rejector - NearestNeighbors with optimizing Micro Distance (3D ROC)
# Experiment 2: Experiment 2: Separated Rejector - OneClassSVM with optimizing Micro Distance (3D ROC)
# Experiment 3: Experiment 3: Separated Rejector - OneClassSVM with optimizing Combined Quality

Table of change (%) of each experiment in comparision with the baseline model
╭─────────────────────────┬─────┬────────┬─────┬────────┬────────┬────────┬────────┬────────╮
│                         │   0 │      1 │   2 │      3 │      4 │      5 │      6 │      7 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Rejection Rate          │ nan │ inf    │ nan │ inf    │ inf    │ inf    │ inf    │ inf    │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Accuracy                │   0 │   0.02 │   0 │   0.86 │   1.36 │   0.86 │   0.35 │   1.1  │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ RMSE                    │   0 │  -0.57 │   0 │  -4.83 │  -6.06 │  -1.6  │  -0.42 │  -3.56 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ ATE Accuracy            │  -0 │   7.94 │  -0 │ -23.96 │ -21.01 │  -0.95 │  -0.45 │  -7.36 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Micro TPR               │   0 │  -7.85 │   0 │ 106.95 │ 108.46 │ -14.8  │ -19.03 │ -32.33 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Micro FPR               │   0 │ -21.21 │   0 │ -34.34 │ -44.44 │ -70.71 │ -42.42 │ -70.71 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Micro F1 Score          │   0 │  -4.96 │   0 │ 108.14 │ 111.33 │  -6.9  │ -14.16 │ -25.66 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Micro Distance (3D ROC) │   0 │   1.51 │   0 │   9.13 │  13.08 │   0.56 │   0.66 │   1.22 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Macro TPR               │   0 │  -7.27 │   0 │ 107.27 │ 109.09 │ -14.55 │ -19.09 │ -31.82 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Macro FPR               │   0 │ -21.21 │   0 │ -33.33 │ -45.45 │ -69.7  │ -42.42 │ -69.7  │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Macro F1 Score          │   0 │  -4.79 │   0 │ 108.51 │ 111.7  │  -6.91 │ -13.83 │ -25.53 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Macro Distance (3D ROC) │   0 │   1.27 │   0 │  10.79 │  14.54 │   0.21 │   0.22 │   0.47 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Accuracy with Rejection │   0 │   0.27 │   0 │   2.01 │   2.38 │   1.67 │   0.89 │   2.16 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Coverage with Rejection │   0 │ -15.31 │   0 │ -49.56 │ -57.32 │  -3.07 │  -1.62 │  -4.56 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Prediction Quality      │   0 │   0.27 │   0 │   2.01 │   2.38 │   1.67 │   0.89 │   2.16 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Rejection Quality       │ nan │ inf    │ nan │ inf    │ inf    │ inf    │ inf    │ inf    │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Combined Quality        │   0 │ -12.67 │   0 │ -40.47 │ -47.14 │   0.61 │   0.35 │   0.21 │
├─────────────────────────┼─────┼────────┼─────┼────────┼────────┼────────┼────────┼────────┤
│ Misclassification Cost  │   0 │  12.65 │   0 │  38.62 │  46.1  │  -1.67 │  -0.46 │  -3.42 │
╰─────────────────────────┴─────┴────────┴─────┴────────┴────────┴────────┴────────┴────────╯